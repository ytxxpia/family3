<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­ç©ºé—´ Â· æ±‡æ€»</title>
    <style>
        /* æç®€ç›´è§’é£æ ¼ï¼Œæ— åœ†è§’ã€æ— æ¯›ç»ç’ƒã€æ— é˜´å½±ã€æ— è¾¹æ¡†è£…é¥° */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            min-height: 100vh;
            background: linear-gradient(180deg, #0079FF 0%, #ffffff 100%);
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem 2rem;
        }
        /* å¹¿å‘Šå›¾åŒºåŸŸâ€”â€”æ— ä»»ä½•ä¿®é¥°ï¼Œç›´æ¥åŸç”Ÿå— */
        .ad-link {
            display: block;
            width: 100%;
            background: none;
            text-decoration: none;
            line-height: 0;
        }
        .ad-img {
            display: block;
            width: 100%;
            height: auto;
            border: none;
            background: #e0e8ff;
        }
        /* æ ‡é¢˜ï¼šä½¿ç”¨ FontAwesome å›¾æ ‡ */
        h1 {
            font-size: 2.4rem;
            font-weight: 400;
            margin: 1.5rem 0 1.5rem 0;
            letter-spacing: 1px;
            color: #0a1a2f;
        }
        /* ä¸¤åˆ—å¸ƒå±€ */
        .row {
            display: flex;
            gap: 2rem;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
        }
        /* å¤©æ°”å—ï¼šç›´è§’ï¼Œæ— ç‰¹æ•ˆï¼Œçº¯è‰²ææµ…èƒŒæ™¯ */
        .weather-block {
            flex: 1 1 280px;
            background: rgba(255, 255, 255, 0.3);
            padding: 1.5rem 1.2rem;
            cursor: pointer;
            border: none;
            border-radius: 0;
        }
        /* è¿‡æœŸè­¦å‘ŠèƒŒæ™¯ */
        .weather-block.expired-bg {
            background-color: #ffe5e5;
        }
        .weather-display {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .weather-icon {
            font-size: 3rem;
            width: 1.5em;
            text-align: center;
            color: #1e3a6b;
        }
        .weather-info {
            font-size: 1.8rem;
            font-weight: 350;
            line-height: 1.3;
        }
        .expired-warning {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #b91c1c;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        /* æ¯æ—¥ä¸€å›¾ iframe å— */
        .daily-image {
            flex: 2 1 400px;
            background: transparent;
            border-radius: 0;
            overflow: hidden;
        }
        .daily-image iframe {
            width: 100%;
            height: 100%;
            min-height: 220px;
            border: none;
            display: block;
            background: rgba(255,255,255,0.2);
        }
        /* æ–‡ç« åˆ—è¡¨åŒºåŸŸ */
        .article-section {
            background: rgba(255, 255, 255, 0.3);
            padding: 1.8rem 2rem;
            border-radius: 0;
        }
        .article-list {
            list-style: none;
            margin-top: 1rem;
        }
        .article-list li {
            margin-bottom: 0.8rem;
            border-bottom: 1px dashed rgba(0,0,0,0.1);
            padding-bottom: 0.8rem;
        }
        .article-list a {
            text-decoration: none;
            color: #003c8b;
            font-size: 1.3rem;
            display: inline-block;
            transition: opacity 0.1s;
            cursor: pointer;
        }
        .article-list a:hover {
            opacity: 0.8;
            text-decoration: underline;
        }
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            height: 400px;
            padding: 0;
            border-radius: 0;
            position: relative;
            border: none;
        }
        .modal-close {
            position: absolute;
            top: 8px; right: 12px;
            font-size: 2rem;
            color: #333;
            cursor: pointer;
            background: transparent;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border: none;
            font-weight: 300;
        }
        .modal iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }
        /* å›¾æ ‡å­—ä½“ */
        @font-face {
            font-family: 'Font Awesome 6 Free';
            font-style: normal;
            font-weight: 900;
            src: url('../FontAwesome/fa-solid-900.woff2') format('woff2');
            font-display: block;
        }
        .fas, .fa-solid {
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            -moz-osx-font-smoothing: grayscale;
            -webkit-font-smoothing: antialiased;
            display: inline-block;
            font-style: normal;
            font-variant: normal;
            line-height: 1;
        }
    </style>
    <!-- FontAwesome CDN å¤‡ç”¨ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<!-- é¡¶ç«¯å¹¿å‘Šå›¾ - ç›´æ¥è´´åœ¨bodyæœ€ä¸Šæ–¹ï¼Œæ— é—´è·æ— è£…é¥° -->
<a href="apk/app.apk" class="ad-link" target="_blank" rel="noopener">
    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='200' viewBox='0 0 1200 200'%3E%3Crect width='1200' height='200' fill='%234286f5'/%3E%3Ctext x='60' y='130' font-family='system-ui, sans-serif' font-size='48' fill='white' font-weight='bold'%3EğŸ“± ç‚¹å‡»ä¸‹è½½ APP %3C/text%3E%3C/svg%3E"
         alt="å¹¿å‘Šï¼šä¸‹è½½åº”ç”¨" class="ad-img">
</a>

<div class="container">
    <h1><i class="fas fa-home"></i> å®¶åº­ç©ºé—´</h1>

    <div class="row">
        <!-- å¤©æ°”æ¨¡å— -->
        <div class="weather-block" id="weatherModule">
            <div class="weather-display" id="weatherDisplay">
                <span class="weather-icon" id="weatherIcon"><i class="fas fa-sun"></i></span>
                <span class="weather-info" id="weatherText">--â„ƒ/-</span>
            </div>
            <div id="expiryWarning" class="expired-warning" style="display: none;">
                <i class="fas fa-exclamation-triangle" style="color:#b91c1c;"></i>
                <span>æ•°æ®å·²è¶…è¿‡8å°æ—¶ï¼Œç‚¹å‡»æ›´æ–°</span>
            </div>
        </div>

        <!-- æ¯æ—¥ä¸€å›¾ iframe -->
        <div class="daily-image">
            <iframe src="api/index-see/see-bing.html" title="æ¯æ—¥ä¸€å›¾" loading="lazy"></iframe>
        </div>
    </div>

    <!-- æ–‡ç« åˆ—è¡¨åŒºåŸŸ -->
    <div class="article-section">
        <h2 style="font-weight: 350; font-size: 1.8rem;"><i class="fas fa-file-alt"></i> æ–‡ç« </h2>
        <ul class="article-list" id="articleList">
            <li>åŠ è½½ä¸­â€¦</li>
        </ul>
    </div>
</div>

<!-- å¤©æ°”æ¨¡æ€æ¡† -->
<div class="modal" id="weatherModal">
    <div class="modal-content">
        <span class="modal-close" id="closeModalBtn">&times;</span>
        <iframe src="api/weather.html" id="weatherIframe" sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-modals"></iframe>
    </div>
</div>

<script>
    (function() {
        const STORAGE_KEY = 'weather_cache';
        const EXPIRY_MS = 8 * 60 * 60 * 1000;

        const iconMap = [
            { keywords: ['æ™´', 'clear', 'sunny'], icon: 'sun' },
            { keywords: ['å¤šäº‘', 'cloudy', 'partly'], icon: 'cloud' },
            { keywords: ['é˜´', 'overcast'], icon: 'cloud' },
            { keywords: ['é›¨', 'rain', 'shower'], icon: 'cloud-rain' },
            { keywords: ['é›ª', 'snow', 'blizzard'], icon: 'snowflake' },
            { keywords: ['é›¾', 'fog', 'mist'], icon: 'smog' },
            { keywords: ['é›·', 'thunder', 'storm'], icon: 'cloud-bolt' },
            { keywords: ['é£', 'wind'], icon: 'wind' }
        ];
        const DEFAULT_ICON = 'sun';

        const weatherModule = document.getElementById('weatherModule');
        const weatherIconSpan = document.getElementById('weatherIcon');
        const weatherTextSpan = document.getElementById('weatherText');
        const expiryWarningDiv = document.getElementById('expiryWarning');
        const modal = document.getElementById('weatherModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const weatherIframe = document.getElementById('weatherIframe');

        function getIconClass(weatherDesc) {
            if (!weatherDesc) return DEFAULT_ICON;
            const lower = weatherDesc.toLowerCase();
            for (let group of iconMap) {
                if (group.keywords.some(kw => lower.includes(kw))) {
                    return group.icon;
                }
            }
            return DEFAULT_ICON;
        }

        function updateWeatherUI(weatherStr, iconName) {
            let displayText = weatherStr || '--â„ƒ/-';
            let finalIcon = iconName || DEFAULT_ICON;
            weatherIconSpan.innerHTML = `<i class="fas fa-${finalIcon}"></i>`;
            weatherTextSpan.innerText = displayText;
        }

        function loadCachedWeather() {
            try {
                const cached = localStorage.getItem(STORAGE_KEY);
                if (!cached) {
                    updateWeatherUI('--â„ƒ/-', DEFAULT_ICON);
                    weatherModule.classList.remove('expired-bg');
                    expiryWarningDiv.style.display = 'none';
                    return;
                }
                const data = JSON.parse(cached);
                const now = Date.now();
                const age = now - data.timestamp;
                const expired = age > EXPIRY_MS;

                updateWeatherUI(data.value, data.icon || DEFAULT_ICON);

                if (expired) {
                    weatherModule.classList.add('expired-bg');
                    expiryWarningDiv.style.display = 'flex';
                } else {
                    weatherModule.classList.remove('expired-bg');
                    expiryWarningDiv.style.display = 'none';
                }
            } catch (e) {
                updateWeatherUI('--â„ƒ/-', DEFAULT_ICON);
                weatherModule.classList.remove('expired-bg');
                expiryWarningDiv.style.display = 'none';
            }
        }

        function saveWeatherAndClose(weatherStr) {
            if (!weatherStr || !weatherStr.includes('/')) return;

            const parts = weatherStr.split('/');
            const temperature = parts[0];
            const weatherDesc = parts[1] || '';
            const iconClass = getIconClass(weatherDesc);

            const cacheData = {
                value: weatherStr,
                icon: iconClass,
                timestamp: Date.now()
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(cacheData));

            updateWeatherUI(weatherStr, iconClass);
            weatherModule.classList.remove('expired-bg');
            expiryWarningDiv.style.display = 'none';

            modal.classList.remove('active');
        }

        weatherModule.addEventListener('click', () => {
            modal.classList.add('active');
            weatherIframe.src = 'api/weather.html';
        });

        closeModalBtn.addEventListener('click', () => {
            modal.classList.remove('active');
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });

        window.addEventListener('message', (event) => {
            if (event.source !== weatherIframe.contentWindow) return;
            const weatherData = event.data;
            if (typeof weatherData === 'string' && weatherData.includes('/')) {
                saveWeatherAndClose(weatherData);
            } else {
                console.warn('æœªçŸ¥çš„å¤©æ°”æ¶ˆæ¯æ ¼å¼', weatherData);
            }
        });

        loadCachedWeather();

        // æ–‡ç« åˆ—è¡¨
        const articleListEl = document.getElementById('articleList');

        async function loadArticles() {
            try {
                const response = await fetch('blog/list.json');
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½æ–‡ç« åˆ—è¡¨');
                const articles = await response.json();
                if (!Array.isArray(articles)) throw new Error('åˆ—è¡¨æ ¼å¼é”™è¯¯');

                if (articles.length === 0) {
                    articleListEl.innerHTML = '<li>æš‚æ— æ–‡ç« </li>';
                    return;
                }

                articleListEl.innerHTML = articles.map(item => {
                    const title = item.title || 'æ— æ ‡é¢˜';
                    const file = item.file || '';
                    return `<li><a href="#" data-file="${file}">${title}</a></li>`;
                }).join('');

                document.querySelectorAll('.article-list a').forEach(link => {
                    link.addEventListener('click', async (e) => {
                        e.preventDefault();
                        const file = link.dataset.file;
                        if (!file) return;

                        try {
                            const mdResp = await fetch(`blog/${file}`);
                            if (!mdResp.ok) throw new Error('è·å–æ–‡ç« å¤±è´¥');
                            const markdown = await mdResp.text();

                            const readWin = window.open('read/read.html', '_blank');
                            if (!readWin) {
                                alert('æ— æ³•æ‰“å¼€é˜…è¯»çª—å£ï¼Œè¯·å…è®¸å¼¹å‡ºçª—å£åé‡è¯•ã€‚');
                                return;
                            }

                            setTimeout(() => {
                                readWin.postMessage(markdown, window.location.origin);
                            }, 1000);
                        } catch (err) {
                            alert('åŠ è½½æ–‡ç« å‡ºé”™: ' + err.message);
                        }
                    });
                });
            } catch (err) {
                // å°†åŸæ¥çš„ âŒ æ›¿æ¢ä¸º FontAwesome å›¾æ ‡
                articleListEl.innerHTML = `<li style="color:#a00;"><i class="fas fa-exclamation-circle"></i> æ–‡ç« åˆ—è¡¨åŠ è½½å¤±è´¥</li>`;
                console.error(err);
            }
        }

        loadArticles();
    })();
</script>
</body>
</html>
