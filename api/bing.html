<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç®€ Â· å¿…åº”æ¯æ—¥ä¸€å›¾</title>
    <style>
        /* ----- å­—ä½“å®šä¹‰ï¼šä¼˜å…ˆç›¸å¯¹è·¯å¾„ï¼Œå¤‡é€‰ CDN ----- */
        @font-face {
            font-family: 'FaSolid';
            src: url('../FontAwesome/fa-solid-900.woff2') format('woff2'),
                 url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/webfonts/fa-solid-900.woff2') format('woff2'),
                 url('https://use.fontawesome.com/releases/v6.0.0-beta3/webfonts/fa-solid-900.woff2') format('woff2');
            font-weight: 900;
            font-style: normal;
            font-display: block;
        }

        /* æ‰€æœ‰ä½¿ç”¨å›¾æ ‡çš„å…ƒç´ ç»Ÿä¸€ç»§æ‰¿å­—ä½“ */
        .fas {
            font-family: 'FaSolid', 'Font Awesome 6 Free', 'FontAwesome', sans-serif;
            font-weight: 900;
            font-style: normal;
            font-variant: normal;
            text-rendering: auto;
            line-height: 1;
            display: inline-block;
            font-size: 1em;           /* ä¸æ–‡å­—ç­‰å¤§ */
            vertical-align: baseline;
            color: currentColor;
        }

        /* é‡ç½® & åŸºç¡€ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background-color: #0b1117;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            transition: background-image 0.4s ease;
            position: relative;
        }

        /* æç®€å®¹å™¨ï¼šå®Œå…¨é€æ˜ï¼Œåªæ²‰åº•æ–‡å­— */
        .minimal-container {
            position: relative;
            width: 100%;
            min-height: 100vh;
            padding: 2rem 2.5rem;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background: transparent;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
            pointer-events: none;
        }

        /* å·¦ä¸‹çº¯æ–‡å­—åŒº */
        .bottom-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.2rem;
            pointer-events: auto;
            max-width: 900px;
        }

        /* æ ‡é¢˜ â€” çº¯æ–‡å­— */
        .title {
            font-size: 2.8rem;
            font-weight: 350;
            line-height: 1.2;
            color: white;
            text-shadow: 0 2px 12px rgba(0, 0, 0, 0.8);
            margin: 0;
        }

        /* ç‰ˆæƒ â€” çº¯æ–‡å­— */
        .copyright {
            font-size: 1.1rem;
            font-weight: 330;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 1px 8px rgba(0, 0, 0, 0.8);
            margin: 0.1rem 0 0.2rem;
        }

        /* ä¸‹è½½å›¾æ ‡è¡Œï¼šæ— ä»»ä½•èƒŒæ™¯/è¾¹æ¡† */
        .download-wrapper {
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
        }

        /* ä¸‹è½½é“¾æ¥ï¼šçº¯å›¾æ ‡ï¼Œä¸æ–‡å­—ç­‰å¤§ï¼Œå¿…é¡»ä½¿ç”¨å›¾æ ‡å­—ä½“ */
        .download-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            font-size: 1.6rem;          /* æ¯”æ­£æ–‡ç¨å¤§ä½†ä¿æŒçº¯ç²¹å›¾æ ‡æ„Ÿ */
            line-height: 1;
            border: none;
            background: none;
            padding: 0;
            margin: 0;
            opacity: 0.9;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
            transition: opacity 0.15s;
            /* å…³é”®ï¼šæ˜¾å¼æŒ‡å®šå­—ä½“ä¸ºå›¾æ ‡å­—ä½“ */
            font-family: 'FaSolid', 'Font Awesome 6 Free', 'FontAwesome', sans-serif;
            font-weight: 900;
        }

        .download-link:hover {
            opacity: 1;
            color: #ffd9a3;
        }

        /* å³ä¸Šæ§åˆ¶æ ï¼šçº¯æ–‡å­— + å›¾æ ‡æŒ‰é’® */
        .top-right {
            position: absolute;
            top: 2rem;
            right: 2.5rem;
            display: flex;
            gap: 1.2rem;
            align-items: center;
            pointer-events: auto;
            color: rgba(255, 255, 255, 0.85);
            text-shadow: 0 1px 8px rgba(0, 0, 0, 0.6);
            font-size: 1rem;
        }

        .date-txt {
            font-size: 1rem;
            letter-spacing: 0.5px;
            color: inherit;
        }

        .nav-btn {
            background: none;
            border: none;
            color: inherit;
            /* å›¾æ ‡å­—ä½“ */
            font-family: 'FaSolid', 'Font Awesome 6 Free', 'FontAwesome', sans-serif;
            font-weight: 900;
            font-size: 1.4rem;
            line-height: 1;
            cursor: pointer;
            padding: 0;
            margin: 0;
            opacity: 0.85;
            transition: opacity 0.15s;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
        }

        .nav-btn:hover {
            opacity: 1;
            color: #ffffff;
        }

        /* å³ä¸‹è§’ææ·¡ BING æ°´å° */
        .bottom-right {
            position: absolute;
            bottom: 2rem;
            right: 2.5rem;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.85rem;
            font-weight: 300;
            letter-spacing: 1px;
            pointer-events: none;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
        }

        /* ç§»åŠ¨ç«¯é€‚åº” */
        @media (max-width: 600px) {
            .minimal-container { padding: 1.5rem; }
            .title { font-size: 2rem; }
            .copyright { font-size: 0.95rem; }
            .top-right { top: 1.2rem; right: 1.5rem; gap: 0.8rem; }
            .bottom-right { bottom: 1.2rem; right: 1.5rem; }
            .download-link { font-size: 1.4rem; }
        }
    </style>
</head>
<body id="bodyBg">

    <div class="minimal-container">
        <!-- å³ä¸Šï¼šæ—¥æœŸ + å›¾æ ‡æŒ‰é’® (æ— èƒŒæ™¯) -->
        <div class="top-right">
            <span class="date-txt" id="displayDate">2025.01.05 å‘¨æ—¥</span>
            <button class="nav-btn" id="prevBtn" title="æ˜¨æ—¥">ï </button>   <!-- å·¦ç®­å¤´  ï  -->
            <button class="nav-btn" id="nextBtn" title="ä»Šæ—¥">ï¡</button>   <!-- å³ç®­å¤´  ï¡ -->
        </div>

        <!-- å·¦ä¸‹ï¼šçº¯æ–‡å­— + ç­‰å¤§ä¸‹è½½å›¾æ ‡ -->
        <div class="bottom-left">
            <div class="title" id="imageTitle">æ‹‰æ–‡çº³ Â· æ°´ä¸‹åœ°ä¸‹å®¤</div>
            <div class="copyright" id="copyrightLine">Â© Andrea Pucci Â· åœ£å¼—æœ—è¥¿æ–¯æ•™å ‚, æ„å¤§åˆ©</div>
            <!-- ä¸‹è½½å›¾æ ‡ï¼šçº¯å›¾æ ‡ï¼Œä¸æ–‡å­—ç­‰å¤§ï¼Œæ— èƒŒæ™¯ -->
            <div class="download-wrapper">
                <a href="#" id="downloadLink" class="download-link" download title="ä¸‹è½½ UHD åŸå›¾">ï€™</a>   <!-- ä¸‹è½½å›¾æ ‡  ï€™ -->
            </div>
        </div>

        <!-- å³ä¸‹è§’æ°´å° -->
        <div class="bottom-right">BING æ¯æ—¥ä¸€å›¾</div>
    </div>

    <script>
        (function() {
            // ---------- é…ç½® ----------
            const API_BASE = 'https://bing.biturl.top';
            const RESOLUTION = 'UHD';
            const MKT = 'zh-CN';
            let currentIndex = 0;  // 0=ä»Šæ—¥, 1=æ˜¨æ—¥, ... æœ€å¤§7

            // DOM å…ƒç´ 
            const bodyEl = document.getElementById('bodyBg');
            const titleEl = document.getElementById('imageTitle');
            const copyrightEl = document.getElementById('copyrightLine');
            const downloadLink = document.getElementById('downloadLink');
            const displayDate = document.getElementById('displayDate');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            // ---------- è¾…åŠ©ï¼šä»å®Œæ•´ç‰ˆæƒä¸­æå–ç®€æ´æ ‡é¢˜ ----------
            function extractShortTitle(fullCopyright) {
                if (!fullCopyright) return 'æœªçŸ¥ä¹‹åœ°';
                let beforeCopyright = fullCopyright.split('Â©')[0].trim();
                if (beforeCopyright.length === 0) beforeCopyright = fullCopyright;
                // æŒ‰ä¸­æ–‡é€—å·åˆ†å‰²ï¼Œå–å‰ä¸¤éƒ¨åˆ†
                let parts = beforeCopyright.split('ï¼Œ');
                if (parts.length >= 2) {
                    return (parts[0] + ' Â· ' + parts[1]).replace(/[,ï¼Œ\s]+$/, '');
                } else if (parts.length === 1) {
                    return parts[0].replace(/[,ï¼Œ]+$/, '');
                }
                return beforeCopyright.substring(0, 40);
            }

            // ---------- æ›´æ–°ç•Œé¢ ----------
            function applyImageData(data, index) {
                if (!data || !data.url) return;

                // èƒŒæ™¯å›¾ï¼ˆåŠ ä¸€ç‚¹æš—å±‚æå‡æ–‡å­—å¯è¯»æ€§ï¼‰
                bodyEl.style.backgroundImage = `linear-gradient(0deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.4) 100%), url('${data.url}')`;

                const fullCopy = data.copyright || 'å¿…åº”æ¯æ—¥å£çº¸';
                titleEl.innerText = extractShortTitle(fullCopy);
                copyrightEl.innerText = fullCopy;

                // ä¸‹è½½é“¾æ¥
                downloadLink.href = data.url;
                downloadLink.setAttribute('download', '');  // æç¤ºä¸‹è½½

                // æ—¥æœŸæ˜¾ç¤º
                if (data.start_date && data.start_date.length === 8) {
                    const y = data.start_date.slice(0,4);
                    const m = data.start_date.slice(4,6);
                    const d = data.start_date.slice(6,8);
                    const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
                    const dateObj = new Date(Number(y), Number(m)-1, Number(d));
                    const wd = weekdays[dateObj.getDay()];
                    displayDate.innerText = `${y}.${m}.${d} ${wd}`;
                } else {
                    // ä¼°ç®—æ—¥æœŸï¼ˆæ ¹æ®ç´¢å¼•ï¼‰
                    const today = new Date();
                    const target = new Date(today);
                    target.setDate(today.getDate() - index);
                    const y = target.getFullYear();
                    const m = String(target.getMonth() + 1).padStart(2,'0');
                    const d = String(target.getDate()).padStart(2,'0');
                    const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
                    const wd = weekdays[target.getDay()];
                    displayDate.innerText = `${y}.${m}.${d} ${wd}`;
                }
            }

            // ---------- ä» API è·å–æ•°æ® ----------
            async function fetchImage(index) {
                const url = `${API_BASE}/?resolution=${RESOLUTION}&format=json&index=${index}&mkt=${MKT}`;
                try {
                    const resp = await fetch(url);
                    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
                    const data = await resp.json();
                    applyImageData(data, index);
                } catch (err) {
                    console.warn('API è¯·æ±‚å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨å›¾ç‰‡', err);
                    // å¤‡ç”¨æ•°æ®ï¼ˆæ‹‰æ–‡çº³å¤§æ•™å ‚ï¼‰
                    const fallback = {
                        url: 'https://www.bing.com/th?id=OHR.RavennaBasilica_ZH-CN1406474730_UHD.jpg',
                        copyright: 'è¢«æ°´æ·¹æ²¡çš„åœ°ä¸‹å®¤ï¼Œåœ£å¼—æœ—è¥¿æ–¯å¤§æ•™å ‚ï¼Œæ‹‰æ–‡çº³ï¼Œæ„å¤§åˆ© (Â© Andrea Pucci/Getty Images)',
                        start_date: '20250105'
                    };
                    applyImageData(fallback, index);
                }
            }

            // ---------- äº¤äº’ ----------
            function goPrev() {
                if (currentIndex < 7) {
                    currentIndex++;
                } else {
                    currentIndex = 7;  // æœ€å¤š7å¤©å‰
                }
                fetchImage(currentIndex);
            }

            function goToday() {
                currentIndex = 0;
                fetchImage(currentIndex);
            }

            // åˆå§‹åŒ–åŠ è½½ä»Šæ—¥
            fetchImage(0);

            // ç»‘å®šæŒ‰é’®
            prevBtn.addEventListener('click', goPrev);
            nextBtn.addEventListener('click', goToday);

            // é”®ç›˜æ”¯æŒ
            window.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    goPrev();
                } else if (e.key === 'ArrowRight' || e.key === 'r') {
                    e.preventDefault();
                    goToday();
                }
            });

            // æ§åˆ¶å°æç¤ºå½’æ¡£æ¥å£ï¼ˆå¯é€‰ï¼‰
            console.log('ğŸ“· å†å²å½’æ¡£ç¤ºä¾‹: https://bing.npanuhin.me/CN/zh.2024.json');
        })();
    </script>
</body>
</html>
